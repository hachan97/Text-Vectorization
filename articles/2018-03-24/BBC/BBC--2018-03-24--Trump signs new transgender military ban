President Trump has signed a memorandum that bans some transgender people from US military service but rolls back the blanket ban he ordered last year.

The new directive adopts recommendations from Defence Secretary Jim Mattis that "transgender persons who require or have undergone gender transition" cannot serve.

But it gives the Pentagon and other agencies some discretion in the matter.

The earlier blanket ban was blocked by federal judges.

The new memorandum says that transgender individuals with a history of gender dysphoria are barred from military service "except under certain limited circumstances".

The Department of Defence (DoD) had submitted a report to the president which said allowing those with a history of gender dysphoria to serve entailed "substantial risks" and could, by exempting them from existing physical, mental and sex-based standards, "undermine readiness... and impose an unreasonable burden on the military".

It said the Obama administration's decision to allow transgender individuals to serve in the military was largely based on a 2016 study by the Rand think-tank, which "contained significant shortcomings".

The report found that allowing transgender people to serve openly would have a minimal impact on force readiness and healthcare costs.

The new policy approved by President Trump allows current transgender service members with gender dysphoria to continue serving if they were diagnosed after the Obama administration's policy took effect.

Transgender individuals not diagnosed with gender dysphoria, will be allowed to serve, "like all other service members, in their biological sex".

Between 4,000 and 10,000 US active-duty and reserve service members are believed to be transgender.

US House Democratic Leader Nancy Pelosi said in a statement that the new policy was "the same cowardly, disgusting ban the president announced last summer".

She said it was meant to "humiliate" transgender service members.

The American Civil Liberties Union, meanwhile, said the policy was "transphobia masquerading as policy" and was not based on new evidence but rather "reverse-engineered for the sole purpose of carrying out President Trump's reckless and unconstitutional ban".

Mr Trump's earlier ban was first announced on Twitter in July 2017, when he posted: "The United States government will not accept or allow transgender individuals to serve in any capacity in the US military."

The order to reverse President Obama's policy was blocked by federal judges who said it was probably unconstitutional.

It is unclear when the new policy will be enacted and it is likely to face legal challenges. On Friday, the Pentagon said it would continue to comply with federal law, and "continue to assess and retain transgender service members".