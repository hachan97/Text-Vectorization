President Donald Trump is reportedly less than pleased with the omnibus spending deal Congress is voting on Thursday to fund the government through the end of September. And he has every right to be frustrated.

The omnibus bill gives the president very little of what he asked for on immigration enforcement  arguably his top domestic policy priority. Not only does it not give him the billions of dollars the White House wants for a big, beautiful wall, or contain restrictions on funding for sanctuary cities, but Congress is actually making an effort to rein in the Trump administrations overspending on immigration detention instead of expanding it.

The president was reportedly threatening as late as Wednesday to veto the bill over these issues, though House Speaker Paul Ryan and Senate Majority Leader Mitch McConnell appear to have talked him down. But the spending deal makes clear that the White Houses current approach to immigration in Congress simply isnt working. And thats guaranteed to piss Trump off.

Congress isnt giving the president the $25 billion the White House says it will take to fulfill its plan to build several hundred miles of barriers along the US/Mexico border. But this bill is technically for the rest of the current fiscal year  the one that expires on September 30. And Congress is actually giving the administration $1.375 billion of the $1.6 billion it requested for border barriers last May, in its budget request for the current fiscal year  even if the omnibus bill insists on calling it fencing rather than a wall.

Theyre appropriating $445 million for 25 miles of levee fencing in the Rio Grande Valley (and another $196 million for an unspecified amount of regular pedestrian fencing there); $251 million to replace 14 miles of existing secondary fencing in the San Diego sector; and $445 million to replace an unspecified amount more of pedestrian fencing. (If youre curious about the difference between primary and secondary fencing, check out our border wall explainer.)

Speaker Paul Ryan and other Republicans have insisted that the bill funds the wall. As policy, theyre right  theres no reason that President Trump couldnt take credit for building a few dozen miles of fencing as continuing to build the wall.

But, crucially, the bill specifically prevents the Trump administration from using any of the new wall designs it commissioned and tested in California last year. All money has to be spent on operationally effective designs deployed as of the date of the Consolidated Appropriations Act, 2017  a bill Trump signed on May 5, 2017.

If President Trump cared less about his wall than about a wall, this wouldnt be an issue. But everything we know about the president indicates thats not the case, and that this is a blow to his ego  he reportedly upbraided congressional Republicans this week for not supporting it, claiming they owed him for his support for the tax bill and his nomination of Neil Gorsuch to the Supreme Court. The bullying tactics do not appear to have worked.

In past spending fights, Trumps (and Democrats) fixation on the wall has kind of obscured things that have an objectively bigger impact on immigration policy  namely, the amount of money being given to Immigration and Customs Enforcement (ICE) to expand interior immigration enforcement and deportations by hiring more agents and expanding immigration detention.

This is an area where congressional Republicans might be expected to fight harder for the administration than a mostly symbolic wall. But theyre not  or, at least, they werent willing to risk a shutdown over it.

Trump wanted 1,000 new ICE agents; hes getting barely 100, and none of them are the field agents responsible for arresting unauthorized immigrants. (Instead, ICE is getting more staff for investigations and mission support.)

And when it comes to immigration detention, Congress isnt just refusing to give the White House the 20 percent increase in detention Trump asked for  its rebuking ICE for overspending and expecting Congress to bail it out.

Under the last budget, ICE was given enough money to keep 39,324 immigrants in detention at any given time. Theyve been overshooting that cap by over 1,000 immigrants a day. To cover the increased costs, theyve been shifting money from other areas  something the administration is allowed to do up to a certain point  and asking for supplemental funding from Congress as, essentially, a reimbursement.

As the explanatory text for the omnibus shows, Congress is not pleased:

The omnibus gives ICE money to keep an average of 40,520 immigrants in detention on any given day. In order to meet that target (and live within their means), theyre going to have to start detaining fewer immigrants than that by the end of the fiscal year.

Compared to what Congress authorized last year, this is still an expansion of detention. But the Trump administration didnt actually take that authorization seriously. And instead of responding by giving ICE the money it needs to keep holding more immigrants, Congress is reminding ICE who holds the purse strings.

To a certain extent, this probably reflects Democrats renewed attention to limiting funding for Trumps immigration agenda, especially in the absence of passing any bills that would legalize any unauthorized immigrants. But the White Houses real problem isnt that Democrats are using their leverage to restrict immigration enforcement money  its that congressional Republican leadership isnt willing to put up a fight (and risk a shutdown) to give the White House what it wants.

The president has hinted in the past that he thinks the border wall is an important enough priority to force a government shutdown. Hes flirted with vetoing bills  including this one  for not including it. As Voxs Tara Golshan has reported, the White House made a belated effort to insist on using the omnibus to target sanctuary cities. None of those threats have gone anywhere with congressional leadership.

Furthermore, the way the Trump administration is carrying out immigration enforcement right now  its detain now, fund later approach  has given congressional Republicans little appetite to insist on keeping detention levels where they are, much less expanding them.

Partly, this is because President Trump isnt spending much capital or attention on the heart of his immigration enforcement operation, relying on the Department of Homeland Security (and Attorney General Jeff Sessions) to do it for him. But partly, it appears to be because a lot of Republicans in Congress dont feel the White House is negotiating with them in good faith on immigration.

After the fight over the Deferred Action for Childhood Arrivals (DACA) program this winter, during which Trump frequently claimed he wanted to make a deal and then rejected any bipartisan deal that came to him, congressional Republicans dont seem that interested in trying to guess what the president will actually sign.

That is, by all appearances, infuriating to Trump. But being furious at Congress doesnt appear to be working. Maybe the White House needs to try something else.